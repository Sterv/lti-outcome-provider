<html><head><title>4 LTI Security Model</title></head><body><LTIDocs><div><h3><h1 class=" toc-headings">4         LTI Security Model<toc class="toc-4"></toc></h1></h3><div class="toc-item-anchor"><a name="toc-15"></a></div><h2 class=" toc-headings">4.1       Basic Launch Credential Management</h2><div class="toc-top-links"><a href="/specs/ltiv1p2/implementation-guide#table-of-contents" target="_blank">Move to top</a></div><p>The security environment for basic launches must be set up using out-of-band interactions between the TP administrator and either the TC administrator or an Instructor who will be authoring a basic launch link.</p><p>As a best practice, the TP should isolate data based on the key. The TP must decide exactly how the key is used to isolate data. For example, the TP might maintain a table that maps multiple keys into a single data silo. Or, the TP might arrange to use the same key repeatedly in all cases where data are to belong to the same data silo.</p><p>There are two possible credentials associated with a particular basic launch.</p><p style="margin-left:.25in;">1.       <strong>TC-wide instance guid and secret</strong> associated with a particular TP.  The TC-wide instance guid establishes the identity of the TC for launches to a particular TP.  Once the TC-wide secret is established for a TP, all basic launches to the TP&rsquo;s domain will use this same secret.  Using a TC-wide secret gives TPs the option of trusting user information and context information across multiple contexts within a particular TC instance as being maintained properly by the TC.</p><p style="margin-left:.25in;">In order to select the TC-wide password to be used for a particular basic launch link, the TC examines the domain name in the launch URL for the basic launch link. The TC-wide password is looked up in the list of TC-wide passwords scanning the domain name of the launch URL from right to left.  So for example, if the launch URL was:</p><p>http://launch.math.vendor.com/launch.php</p><p style="margin-left:.25in;">The TC would look up the following TC-wide secret keys in order from specific to general: launch.math.vendor.com, math.vendor.com, and then vendor.com. So when TPs are generating link URLs and giving them to an instructor or embedding those links in a cartridge, it is important to use consistent domain names in those launch URLs so as to be able to match a TC-wide secret for a particular TP with the appropriate launches.</p><p style="margin-left:.25in;">2.       <strong>Link-level key and secret associated with a particular link. </strong> This will occur when the basic launch link is directly authored by the instructor within the TC.  This secret will often be produced when the Instructor creates or gains access to a TP content/tool and the TP content/tool provides the instructor with a key and secret associated with the TP link.</p><p style="margin-left:.25in;">Basic launches can happen from the TC with any combination of TC-wide and link-level credentials including one or the other, both, or neither being present. When both are present the launch uses the TC-wide secret to sign the request.</p><p style="margin-left:.25in;">If there is no key/secret combination available for this launch and the TC wants to perform the launch, the TC should not sign the launch data using OAuth. The TC can decide if it wants to send unsigned requests and the TP can decide if it wants to accept unsigned requests. A TC may also choose to treat the lack of key/secret values as an error and refuse to perform the launch.</p><p></p><div class="toc-item-anchor"><a name="toc-16"></a></div><h2 class=" toc-headings">4.2       OAuth Message Signing for x-www-form-urlencoded Messages</h2><div class="toc-top-links"><a href="/specs/ltiv1p2/implementation-guide#table-of-contents" target="_blank">Move to top</a></div><p>OAuth signing is a security mechanism designed to protect POST and GET requests.  This section only applies to protecting launch and other messages that are being serialized and sent using POST.</p><p>The OAuth 1.0 specification [OAuth, 10] specifies how to construct a base message string and then sign that string using a secret. The signature is then sent as part of the POST request and is validated by the TP using OAuth. The website <a href="http://www.oauth.net" target="_blank">http://www.oauth.net</a> contains the specification for OAuth 1.0 and sample source code for implementing OAuth signing.</p><p>Per the OAuth specification, the signing process produces a number of values that are to be added to the launch request including the <strong>oauth_consumer_key</strong>:<br></br></p><p style="margin-left:.5in;">oauth_consumer_key=b289378-f88d-2929-ctools.umich.edu</p><p style="margin-left:.5in;">oauth_signature_method=HMAC-SHA1</p><p style="margin-left:.5in;">oauth_timestamp=1244834250</p><p style="margin-left:.5in;">oauth_nonce=1244834250435893000</p><p style="margin-left:.5in;">oauth_version=1.0</p><p>oauth_signature=Xddn2A%2BjzwjgBIVYkvigaKxCdcc%3D</p><p>oauth_callback=about:blank</p><p></p><p>The important values for signing a message using OAuth are the <strong>oauth_consumer_key</strong> and <strong>oauth_consumer_secret</strong>.  The <strong>oauth_consumer_key</strong> is passed in the message as plain text and identifies which TC (e.g., LMS) is sending the message allowing the TP (i.e., application) to look up the appropriate secret for validation.   The <strong>oauth_consumer_secret</strong> is used to sign the message.</p><p>The <strong>oauth_callback</strong> is really not used in a signing-only scenario (OAuth 1.0 documentation section 6.2.3 [OAuth, 10]) so if your OAuth library demands it, you can set it to any value such as "about:blank".  Also note that <strong>launch_presentation_return_url</strong> serves a very different purpose from <strong>oauth_callback</strong>.</p><p>Since we are using OAuth in a signing-only scenario (i.e., we are not using OAuth to transfer third-party identity), there is no need for an <strong>oauth_token</strong>.</p><p>Tool Providers must support at a <em>minimum</em> the <strong>HMAC-SHA1</strong> signing method with OAuth data passed as POST data. </p><p>Upon receipt of the POST, the TP will perform the OAuth validation utilizing the shared secret it must have stored locally for the relationship with the TC in the <strong>oauth_consumer_key</strong>.  The timestamp should also be validated to be within a specific time interval.  This time interval can be TP defined, but should be small (on the order of a few minutes if you do not record nonces or a few hours if you do).  It does rely on the time on the TC and the TP being in sync though.</p><p>The TP should keep a record of nonces received and only allow the use of any nonce a single time.  Combined with the timestamp, this means that they only have to keep track of nonces for a period of time equal to their acceptable time interval.  Recommended practice would be to have a time interval of 90 minutes so that you keep a record of nonces for 90 minutes. </p><p>NOTE that this security profile requires the TC and TP to have synchronized clocks.  The use of a configurable time interval can adjust for slightly-off clocks, but setting the interval too large is discouraged.</p><p></p><div class="toc-item-anchor"><a name="toc-17"></a></div><h2 class=" toc-headings">4.3       Security for application/xml Messages</h2><div class="toc-top-links"><a href="/specs/ltiv1p2/implementation-guide#table-of-contents" target="_blank">Move to top</a></div><p>These services follow a "Plain Old XML" (POX) pattern and the messages are signed using OAuth body signing to insure message integrity and establish the identity of the calling system (i.e., the TP).</p><p>The body of the message is XML that follows the schema for the particular service operation requested, and the message is signed using the <strong>oauth_consumer_key</strong> and <strong>oauth_consumer_secret</strong> that was used to do the launch of the tool for the particular user/course/resource.</p><p>The procedure for signing a body using OAuth [OBH, 11] is described on this website: <a href="http://oauth.googlecode.com/svn/spec/ext/body_hash/1.0/oauth-bodyhash.html" target="_blank">http://oauth.googlecode.com/svn/spec/ext/body_hash/1.0/oauth-bodyhash.html</a></p><p>It is important that all messages using these services must use a content type of <strong>application/xml</strong>. The services may legitimately reject any other content type.  In particular, the OAuth body signing specification specifically prohibits the combination of <strong>oauth_body_hash</strong> and <strong>x-www-form-urlencoded</strong> data in any request.</p><p>As per the OAuth body hashing specification, all of the OAuth parameters must be sent as part of the <strong>Authorization</strong> header. In particular, OAuth parameters from the request URL and POST body will be ignored.</p><p>The <strong>oauth_body_hash</strong> [OBH, 11] is computed using a SHA-1 hash of the body contents and added to the <strong>Authorization</strong> header. All of the OAuth parameters, HTTP method, and URL are signed like any other OAuth signed request.  Other than in producing the body hash value, the actual POST data is not involved in the computation of the <strong>oauth_signature</strong>.</p><p>Most OAuth libraries can produce and verify the signatures for these messages as most libraries already support sending OAuth parameters in the <strong>Authorization</strong> header.</p><p>A sample signed request is shown below. The line-breaks in the <strong>Authorization</strong> header are there to make it easier to read the values. The <strong>oauth_signature</strong> is not valid for the data below, it is just an example signature.</p><p></p><p>POST http://www.imsglobal.org/developers/BLTI/service_handle.php HTTP/1.0</p><p>Host: 127.0.0.1:80</p><p>Content-Length: 757</p><p>Authorization: OAuth realm="",oauth_version="1.0",</p><p>oauth_nonce="29f90c047a44b2ece73d00a09364d49b",</p><p>oauth_timestamp="1313350943",oauth_consumer_key="lmsng.school.edu",</p><p>oauth_body_hash="v%2BxFnmDSHV%2Fj29qhxLwkFILrtPo%3D",</p><p>  oauth_signature_method="HMAC-SHA1",</p><p>oauth_signature="8auRpRdPY2KRXUrOyz3HKCs92y8%3D"</p><p>Content-type: application/xml</p><p></p><p><?xml version = "1.0" encoding = "UTF-8"?></p><p><imsx_POXEnvelopeRequest xmlns = "http://www.imsglobal.org/services/ltiv1p1/xsd/imsoms_v1p0">  </p><p>  <imsx_POXHeader></p><p><imsx_POXRequestHeaderInfo>     </p><p><imsx_version>V1.0</imsx_version></p><p><imsx_messageIdentifier>999999123</imsx_messageIdentifier>    </p><p></imsx_POXRequestHeaderInfo>  </p><p>  </imsx_POXHeader></p><p>  <imsx_POXBody>    </p><p>    <readResultRequest></p><p>      <resultRecord></p><p>        <sourcedGUID></p><p><sourcedId>3124567</sourcedId></p><p></sourcedGUID></p><p></resultRecord>   </p><p></readResultRequest>  </p><p>  </imsx_POXBody> </p><p></imsx_POXEnvelopeRequest></p><p>Please consult the IMS General Web Services for details about the fields within the <strong>ims_POXHeader</strong>. These definition and values for the header items are taken directly from IMS General Web Services.  See "Table A1.2 Interpretation of the 'CodeMajor/severity' matrix" from IMS General Web Services WSDL Binding Guidelines [GWS, 06] for further details on header values for 'unsupported' and 'failure' responses.</p><p>Each service will define its own XML Schema for the <strong>imsx_POXBody</strong> Request and Response content for a particular operation within a particular service.</p><div class="toc-item-anchor"><a name="toc-5"></a></div></div></LTIDocs></body></html>